<html xmlns:xi="http://www.w3.org/2001/XInclude" lang="en">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
      <title>The cgi-bin environment</title>
      <authors>
         <person email="trond.trosterud@uit.no" name="Trond Trosterud"></person>
         <person email="saara.huhmarniemi@helsinki.fi" name="Saara Huhmarniemi"></person>
      </authors>
   </head>
   <body>
      <h1>CGI-setup</h1>
      <p>Our programs are available on the net for analyzing and generating wordforms
         and paradigms for different languages. The tools can be called from
         pages on <a href="http://giellatekno.uit.no/cgi">http://giellatekno.uit.no/cgi</a>.
      </p>
      <p>The pages are available for calling the tools in different languages. For
         the time being, the supported user interface languages are English,
         North, Lule and South Saami, Finnish, Russian and Norwegian.
         The tools are available to a varying extent for
         the approximately 30 languages found on the frontpage.
      </p>
      <p>The cgi-bin scripts include scripts for analysing and generating
         words and sentences in various way. The setup is divided between two systems, the
         cgi-bin and forrest documentation. For example, when adding a new
         language to the system, changes have to be made both in cgi-bin and
         forrest documentation.
      </p>
      <h2>CGI-scripts</h2>
      <p>The relevant scripts cgi-bin scripts are:</p>
      <ul>
         <li>smi.cgi<br> Language-independent cgi-script for calling
            different language technology applications: analysis,
            disambiguation, hyphenation and paradigm generation.
         </li>
         <li>conf.pl<br> Configuration file that contains most of the
            variable definitons and their initial values.
         </li>
         <li>LANG-num.cgi<br> (where LANG = the languages for which there
            are numeral generators: fin, kom, mhr, nno, rus, sjd, sma, sme, smj,
            smn, sms, yrk. 
         </li>
      </ul>
      <p>All the scripts are developed in the svn-directory, under the module
         <code>gt/scripts/cgi-scripts</code>. The official location of
         cg-scripts is on gtweb, at the cgi-bin directory under /var/www. The latest
         versions are moved to the official directory. There is a script doing
         this, <code>cgi-export</code> exporting the latest version of the
         release-tagged cgi-scripts to the directory. The user must have root
         privileges to be able to run the script. In practice, we have been
         copying the files to the official directory manually.
      </p>
      <p>The cgi-bin script smi.cgi is located on gtweb, at the cgi-bin
         directory. The script processes input sentences from the html scheme
         by the user, and then sends it on to the transducers sme.fst for
         analysis and isme.fst for generation. The language, charset and the
         action taken are configured by the parameters given to the script.
      </p>
      <p>The transducers are located at
         <code>/opt/smi/LANG/bin/</code>and<code>/opt/smi/common/bin/</code></p>
      <p>The minimum requirements for an analyzer to work is the
         file<code>lang.fst.</code></p>
      <p><a href="QuasicodeForKeepingTrackOfTransducers.html">Procedures for copying new fsts to /opt/smi is found here</a>.
      </p>
      <p></p>
      <h1>Forrest documentation and cgi-bin</h1>
      <p>The cgi-interface is integrated with Forrest documentation and the
         pages are generated when needed. The pages are named after the language
         technology application, the language of the application and the user
         interface language. The prefixes <code>d- g- p- </code>stand for
         disambiguation (and analysis and hyphenation), generation and paradigm
         generation. For example the file d-sme.sme.html calls analysis tools for
         North Saami and the user interface is in North Sámi. The file
         p-sme.eng.html calls paradigm generation for North Sámi, the language of
         the user interface being English. Finally the file g-sme.nor.html calls
         generator for North Saami with Norwegian as the user interface
         language.
      </p>
      <p>The texts for different user interface languages are stored in
         XML-files in the documentation under the name:
         <code>xtdoc/gtuit/src/documentation/content/xdocs/cgi/cgi-lang.xml</code>.
         There is an xsl-script for creating the html-pages for different
         language technology applications and transferring the texts from the
         XML-files to the page. The script in question is <code>xtdoc/gtuit/src/documentation/resources/stylesheets/cgi-index.xsl</code>. The Forrest documentation does not pose a limit
         to the languages that are used for the documentation.
      </p>
      <p>After the cgi-script is called the user interface to the cgi is
         regenerated together with the results of the query by <code>smi.cgi</code>. The same
         XML-file that contains the texts for the user interface is used for
         generating the new html-page.
      </p>
      <h1>An example: how to add new language to the documentation</h1>
      <p>To add a new language, changes have to be made both in the server
         side and in forrest documentation.
      </p>
      <h2>Changes to cgi-bin at gtweb</h2>
      <p>Compile relevant transducers and abbr.txt and copy them to the
         transducer dir
      </p>
      <pre xml:space="preserve">mkdir -p /opt/smi/lang/bin
cp the/transducers/etcetera /opt/smi/lang/bin/
chgrp cvs /opt/smi/lang/bin/*
chmod 775 /opt/smi/lang/bin/*</pre>
      <p>If you want these files to be updated automatically each day, then
         add the language code to the (now outdated) script <code>fst2opt</code>.
         Note that this script must be outdated to reflect the new server etc.
      </p>
      <h2>Changes to forrest documentation</h2>
      <p>In order to create a new interface language: First: Please don't. We already
         have seven. Then, if you still want one: First create a page for the language,
         LANG.xml and store it
         to<code>xtdoc/gtuit/src/documentation/content/xdocs/</code>. Then add
         links to the analysis pages as shown on the other LANG.xml pages.
      </p>
      <p>The analysis pages are generated automatically by forrest. However, the first
         versions are quite reduced, since there are no language specific texts
         automatically available. To add text to the page, edit the different
         interface texts in the catalogue cgi, e.g. for English the file:
      </p>
      <pre xml:space="preserve">xtdoc/gtuit/src/documentation/content/xdocs/cgi/cgi-eng.xml</pre>
      <p>Note that there are seven x 2 files in the cgi catalogue, and eight
         language will then give rise to two new files.
      </p>
      <h1>Updating the transducers</h1>
      <p>Earlier, the transducers and other relevant files were updated daily using
         the <code>cron</code> facility. The script <code>gt/script/fst2opt</code> esd
         responsible for retrieving the latest version from cvs, compiling the
         binaries and copying them to the relevant directories. The crontab was
         set up by the person who is responsible of the cgi-bin setup. Due to unstable
         fsts we abandoned this system and instead went for a fully manual system.
         Now, with the number of languages rising, we want a semi-automatic system.
      </p>
      <h1>The cgi-bin scripts</h1>
      <p>The cgi-bin files are written in Perl and use the Perl module CGI.pm.
         The file smi.cgi is used for analysing and disambiguating as well as
         generating for different languages. It can be used for new
         languages without any additional configuration, when the tools that are
         used by the script (lang.fst etc.) are in place.
      </p>
      <p>The script contains a conversion from digraphs c1, s1, etc. to some
         utf-8 characters: č, š, etc. for those who don't have Saami characters in
         the keyboard. The latin-1 can be chosen as an input language as well,
         but the page that is generated is utf-8 encoded. The option is tested at
         the moment and it may turn out that it's not useful. We should consider abandoning
         this option.
      </p>
      <p>The files contain a very good documentation themselves (thanks to Ken
         Beesley, their original author). For info on how to maintain them, see
         available books on perl and cgi-bin.
      </p>
      <ol>
         <li>Edit the cgi-bin files in cvs-module
            <code>gt/script/cgi-scripts</code></li>
         <li>Commit the changes to svn</li>
         <li>If the version is ready for release, tag the version with
            release-tag using command <code>cvs tag -F release filename1 filename2
               ..</code>. (this is not in use)
         </li>
         <li>then:
            
            <ol>
               <li>either execute the script <code>cgi-export</code>. The tagged files are
                  exported from the cvs to the official directory. (this option is presently not in
                  use)
               </li>
               <li>or (the option in use) copy the cgi-bin files manually to the var/www/smi/cgi-bin
                  directory.
               </li>
               <li>In any case, make sure the www catalogue and the svn catalogue are in synch!</li>
            </ol>
            
         </li>
      </ol>
      <h1>Linking due to security</h1>
      <p>For security reasons, the webserver on gtweb.uit.no is run via
         symbolic links.
      </p>
      <p>The url to the cgi-bin scripts is:
         <code>http://sami-cgi-bin.uit.no/cgi-bin/smi/</code>, and it is now moving to
         <code>http://gtweb-bin.uit.no/cgi-bin/smi/</code></p>
   </body>
</html>