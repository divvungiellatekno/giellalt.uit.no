<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE document PUBLIC "-//APACHE//DTD Documentation V2.0//EN"
"http://forrest.apache.org/dtd/document-v20.dtd">
<document xml:lang="en"> 
    <header> 
        <title>Setup and maintenance of the web server</title>
        
        <authors>
            <person name="BÃ¸rre Gaup" email="borre.gaup@samediggi.no" />
        </authors>
        
    </header> 
    <body> 
        <section>
            <title>Configuration of the web server</title>
            
            <p>Debian stable has been installed on the server, and suns java sdk 1.5 has been installed on it. tomcat5 packages aren't available for debian stable, so they have been fetched from the unstable distribution.</p>

            <section>
                <title>Howto make a debian package from suns java sdk</title>
                <ul>
                    <li>Go to Suns <a href="http://java.sun.com/j2se/1.5.0/download.jsp">java download area</a>. Click on the link to the newest jdk, and download the Linux self-extracting file.</li>
                    <li>Fetch the java-package, using the command <code>apt-get install java-package</code>. This will make a debianized package of the jdk.</li>
                    <li>Go into the directory where you saved the jdk, and issue the command <code>make-jpkg &lt;sun-jdk-package-name&gt;</code></li>
                    <li>Install, using the command <code>dpkg -i pkg-name</code>.</li>
                </ul>
            </section>

            <section>
                <title>Installing tomcat5 from unstable on debian stable</title>

                <p>Insert the following line into /etc/apt/sources.list</p>
                <source>deb ftp://ftp.no.debian.org/debian/ testing main contrib non-free
</source>

                <p>To set up what is your main version of Debian you should edit the /etc/apt/apt.conf (it does not usually exist, create it if you don't have one) to contain the following line:</p>
                <source>APT::Default-Release "stable";</source>
                
                <p>Upgrade the package descriptions using the command: <code>apt-get update</code>.</p>
                <p>Install tomcat5 packages: <code>apt-get install -t unstable tomcat5 tomcat5-admin tomcat5-webapps</code>. The tomcat5 server will be started automatically, as the user tomcat5. The webapps live in the directory <code>/var/lib/tomcat5/webapps</code>.</p>

                <section>
                    <title>Starting and stopping tomcat5</title>
                    <ul>
                        <li>The tomcat5 server can be stopped by using the command <code>/etc/init.d/tomcat5 stop</code>.</li>
                        <li>To start it use the command <code>/etc/init.d/tomcat5 start</code>.</li>
                        <li>To do a immidiate stop/start, use the command <code>/etc/init.d/tomcat5 restart</code>.</li>
                    </ul>
                </section>
            </section>

            <section>
                <title>Setting up divvun.no and giellatekno.uit.no</title>

                <p>Make a war file using the command forrest war. Copy these files to the directory <code>/var/lib/tomcat5/webapps</code>. The tomcat5 server will automatically unpack these files and they are visible on the address <code>http://localhost:8180/divvun-no</code> and <code>http://localhost:8180/giellatekno</code>. Through some magic using dns and routers these sites are available on the net as <em>http://www.divvun.no/</em> and <em>http://giellatekno.uit.no/</em>.</p>
            </section>

            <section>
                <title>Maintenance of the sites</title>
                
                <p>To maintain the sites we decided to make a script that automatically can fetch updated files from the cvs server and copy them to the tomcat5 webapps area.</p>

                <p>For the site we would like to use google as the search motor, as opposed to local forrest run instances, where we would like to use lucene as the search motor. This means that we make manual updates of the skinconf.xml file. As a consequence only the xdocs directory are automatically renewed.</p>

                <p>If we need new features implemented in forrest, we will make new .war files and deploy them. To do this we will have to stop the tomcat5 server, copy the war files to /var/lib/tomcat5/webapps, and then start the tomcat5 server again.</p>

                <p>If we need to change forrest.properties we only need to copy it into <code>/var/lib/tomcat5/webapps/&lt;site&gt;/project/</code> and restart the tomcat5 server.</p>
            
                <p>We have set up an user account on the server. This user account has a private/public passwordless ssh key, to be able to fetch updates from the cvs server.</p>

                <p>The xtdoc cvs tree has been checked out, and skinconf.xml has been edited to use google as a search motor for the site. The gt/doc tree has been copied into the gtuit and sd trees.</p>

                <p>This user has also been setup to be able to copy the updated files as into the tomcat5 area as the tomcat5 user via sudo.</p>

                <p>To be able to send error messages via mail postfix has been installed.</p>

                <p>Details on how the maintenance script works is documented in the script <code>gt/script/divvun2web</code>.</p>
            </section>
            
        </section>
    </body>
</document>
