<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE document PUBLIC "-//APACHE//DTD Documentation V2.0//EN"
"http://forrest.apache.org/dtd/document-v20.dtd">
<document xml:lang="en">
    <header>
        <title>Corpus analysis on stallo</title>
    </header>

    <body>
        <section>
            <title>Pre analysis</title>
            <section>
                <title>Building tokenisers</title>
                <p>
                    Tokenisers are built once a week on gtlab.
                    The comments in
                    <a href="https://gtsvn.uit.no/langtech/trunk/tools/stallo-analysis/build-tokenisers.sh">
                        $GTHOME/tools/stallo-analysis/build-tokenisers.sh
                    </a>
                    details what is being done.
                </p>
                <p>The tokeniser build jobs are kicked off by this cronjob
                    <code>45 19 * * sat source $HOME/.bash_profile &amp;&amp; svn up $GTHOME/tools/stallo-analysis/build-tokenisers.sh &amp;&amp; $GTHOME/tools/stallo-analysis/build-tokenisers.sh</code>
                </p>
                <p>
                    The hfst tools on this machine are updated at least once a week from the nightly apertium repo.
                </p>
            </section>
            <section>
                <title>Fetch converted corpus and kick off analysis</title>
                <p>The analysis is kicked off by this cronjob on gtlab:
                    <code>00 03 * * sun ssh stallo.uit.no ". $HOME/.bash_profile &amp;&amp; ls -lR $HOME/.local/share/giella &amp;&amp; svn up $HOME/svnrepos/langtech/tools &amp;&amp; $HOME/svnrepos/langtech/tools/stallo-analysis/pre-analysis.sh"</code>
                </p>
                <p>
                    The script
                    <a href="https://gtsvn.uit.no/langtech/trunk/tools/stallo-analysis/pre-analysis.sh">
                        $GTHOME/tools/stallo-analysis/pre-analysis.sh
                    </a> fetches the converted corpus files and dispatches
                    separate analysis jobs for each corpus, language and type
                    (type being xfst and hfst).
                </p>
            </section>
        </section>
        <section>
            <title>Analysis</title>
            <p>
                The analysis is done on the <code>boerre</code> account on <code>stallo</code>.
                The comments in
                <a href="https://gtsvn.uit.no/langtech/trunk/tools/stallo-analysis/analyse.sh">
                    $GTHOME/tools/stallo-analysis/analyse.sh
                </a>
                details what is being done. The grunt work is done by the program
                <a href="https://giellalt.uit.no/ling/CorpusTools.html#analyse_corpus">
                    analyse_corpus
                </a>.
            </p>
        </section>
        <section>
            <title>Post analysis</title>
            <p>Analysed files are sent to gtweb by this cron job.
                <code>00 08 * * sun ssh stallo.uit.no ". $HOME/.bash_profile &amp;&amp; $HOME/svnrepos/langtech/tools/stallo-analysis/post-analysis.sh"</code>
            </p>
            <p>
                The script
                <a href="https://gtsvn.uit.no/langtech/trunk/tools/stallo-analysis/post-analysis.sh">
                    $GTHOME/tools/stallo-analysis/post-analysis.sh
                </a>
                details what is being done.
            </p>
        </section>
        <section>
            <title>Files and compilers</title>
            <p>
                These are the repositeries found on stallo:
            </p>
            <ul>
                <li>The langtech repo: <code>~boerre/svnrepos/main/</code></li>
                <li>The freecorpus repo: <code>~boerre/svnrepos/freecorpus/</code></li>
                <li>The boundcorpus repo: <code>~boerre/svnrepos/boundcorpus/</code></li>
                <li>The rusbound repo: <code>~boerre/svnrepos/rusbound/</code></li>
            </ul>
            <p>
                The xfst, hfst, vislcg3 and CorpusTools tools are installed in <code>~boerre/bin</code>
                on stallo.
            </p>
            <section>
                <title>hfst: Build commands</title>
                <source>cd ~/hfst/
git pull
module load autoconf/2.69
module load automake/1.13.1
module load gcc/4.9.1
./autogen.sh
./configure --enable-all-tools --with-unicode-handler=glib --prefix=/home/boerre --with-readline
make
make install</source>
            </section>
            <section>
                <title>vislcg3: Build commands</title>
                <source>module load CMake/3.6.2-foss-2016b
module load Boost/1.61.0-foss-2016b
module load ICU
cd ~/svnrepos/vislcg3/
svn up
cmake \
    -DCMAKE_INCLUDE_PATH=/global/hds/software/cpu/eb3/ICU/61.1-iomkl-2018a/include/ \
    -DCMAKE_LIBRARY_PATH=/global/hds/software/cpu/eb3/ICU/61.1-iomkl-2018a/lib/ \
    -DCMAKE_EXE_LINKER_FLAGS=-L/global/hds/software/cpu/eb3/ICU/61.1-iomkl-2018a/lib \
    .
make
make install</source>
            </section>
            <section>
                <title>CorpusTools: Install commands</title>
                <source>cd ~/svnrepos/main/tools/CorpusTools/
svn up
python setup.py develop --user</source>
            </section>
            <section>
                <title>Environment variables on stallo</title>
                <p>
                    These environment variables are set on stallo to make hfst and vislcg3
                    work as expected:
                </p>
                <source>export PATH=$HOME/bin:$PATH
export LD_LIBRARY_PATH=$HOME/lib:$LD_LIBRARY_PATH</source>
            </section>
        </section>
    </body>
</document>
