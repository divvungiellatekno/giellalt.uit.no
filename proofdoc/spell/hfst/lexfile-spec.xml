<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE document PUBLIC "-//APACHE//DTD Documentation V2.0//EN"
"http://forrest.apache.org/dtd/document-v20.dtd">
<document>
   <header>
      <title>Hfst speller files</title>
      <subtitle>Specification for an hfst-based speller lexicon file format</subtitle>
      <version>0.1</version>
   </header>
   <body>
      <p>This document specifies the different parts of a speller lexicon file format to be used together with an
      hfst-based speller engine.</p>
      <section>
         <title>Base file format - zip archive</title>
         <p>øaskg</p>
         <section>
            <title>File naming convention</title>
            <p>The default file name for the zip file is:</p>
            <source>LOCALE.zhfst</source>
            <p>where</p>
            <dl>
               <dt><code>LOCALE</code></dt>
               <dd>specifies the locale for which the speller lexicon is meant to be used for, following BCP 47</dd>
               <dt><code>zhfst</code></dt>
               <dd>indicates a zipped collection of (mostly) hfst files</dd>
            </dl>
         </section>
         <section>
            <title>Exceptions to file naming conventions</title>
            <p>There might be application-specific or even plattform-specific reasons to not follow the locale
            convention above, cases where the plattform or the host application prescribes a different naming
            conventions. Only when such naming conventions are mandatory should the naming convention described in this
            document be deviated from. In all other cases the file naming convention described above should be
            followed.</p>
         </section>
      </section>
      <section>
         <title>Zip file content - file naming conentions of contained files</title>
         <p>The zip archive should contain the following files:</p>
         <source>index.xml
LOCALE.hfst
errmodel1.hfst
errmodel2.hfst
...
errmodeln.hfst</source>
         <p>where</p>
         <dl>
            <dt><code>index.xml</code></dt>
            <dd>is a simple xml file (structure described below) giving details about the rest of the zip file
            content.</dd>
            <dt><code>LOCALE.hfst</code></dt>
            <dd>is the acceptance transducer; filename as for the zip file, although there are NO exceptions to the
            filename convention for this file (ie it MUST follow BCP 47). The transducer can either be a one-level or a
            two-level transducer; if it is a two-level transducer, the other level must produce analyses of the correct
            words or the accepted suggestions produced by the error models, and the fact that it is a two-level
            transducer producing analyses must be expressed in the <code>index.xml</code> file's description of this
            file. It is an error to archive an analysing speller transducer without stating so in the
            <code>index.xml</code> file.</dd>
            <dt><code>errmodel1.hfst...errmodeln.hfst</code></dt>
            <dd>is one or more transducers containing spelling error corrections ("error models") for the speller.</dd>
         </dl>
      </section>
      <section>
         <title>Structure of <code>index.xml</code></title>
         <p>The structure of the <code>index.xml</code> file can be exemplified by the following xml document for a
         North Sámi speller (with a simple BCP 47 locale name of just 'se', the ISO 639-1 code for the language):</p>
         <source>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;hfstspeller version="1.0"&gt;
    &lt;info&gt;
        &lt;title&gt;Davvisámegiela divvunxxx&lt;/title&gt;
        &lt;title xml:lang="nn"&gt;Nordsamisk stavekontroll&lt;/title&gt;
        &lt;title xml:lang="en"&gt;North Sámi speller&lt;/title&gt;
        &lt;description&gt;[North Sámi description here]&lt;/description&gt;
        &lt;description xml:lang="nn"&gt;Ein stavekontroll for nordsamisk
        laga av Divvun-prosjektet i samarbeid med Senter for samisk
        språkteknologi, Universitetet i Tromsø&lt;/description&gt;
        &lt;version vcsrev="33459"&gt;1.5.73&lt;/version&gt;
        &lt;date&gt;2010-09-23&lt;/date&gt;
        &lt;producer&gt;Divvun&lt;/producer&gt;
        &lt;contact email="divvun@samediggi.no" website="http://www.divvun.no/"/&gt;
    &lt;/info&gt;
    &lt;acceptor analyzing="true" id="se.hfst"/&gt;
    &lt;errmodel id="errmodel1.hfst"&gt;
        &lt;title&gt;[North Sámi name of error model]&lt;/title&gt;
        &lt;title xml:lang="nn"&gt;Standardkorrigering&lt;/title&gt;
        &lt;title xml:lang="en"&gt;Default corrections&lt;/title&gt;
        &lt;description xml:lang="nn"&gt;Ein korrigeringsmodell balansert mellom rask
        responstid og fleire relevante retteforslag.&lt;/description&gt;
        &lt;description xml:lang="en"&gt;A correction model balanced between fast
        response times and more relevant correction suggestions.&lt;/description&gt;
    &lt;/errmodel&gt;
    &lt;errmodel id="errmodel2.hfst"&gt;
        &lt;title&gt;[North Sámi name of error model]&lt;/title&gt;
        &lt;description&gt;[North Sámi description here]&lt;/description&gt;
        &lt;title xml:lang="nn"&gt;Hurtigkorrigering&lt;/title&gt;
        &lt;description xml:lang="nn"&gt;Ein korrigeringsmodell som gjev rask
        responstid og færre forslag.&lt;/description&gt;
    &lt;/errmodel&gt;
    &lt;errmodel id="errmodel3.hfst"&gt;
        &lt;title&gt;[North Sámi name of error model]&lt;/title&gt;
        &lt;title xml:lang="nn"&gt;Mange skrivefeil&lt;/title&gt;
        &lt;description&gt;[North Sámi description here]&lt;/description&gt;
        &lt;description xml:lang="nn"&gt;Ein langsamare korrigeringsmodell som prøver
        å korrigera fleire skrivefeil i kvart ord.&lt;/description&gt;
    &lt;/errmodel&gt;
&lt;/hfstspeller&gt;</source>
         <p>This corresponds to the following DTD:</p>
         <source>&lt;!ELEMENT hfstspeller (info, acceptor, errmodel+)&gt;
&lt;!ATTLIST hfstspeller 
  version  CDATA #IMPLIED
  &gt;

&lt;!ELEMENT info (title+, description+, version, date, producer, contact)&gt;

&lt;!ELEMENT title (#PCDATA)&gt;
&lt;!ATTLIST title 
  xml:lang NMTOKEN #IMPLIED&gt;
  &gt;

&lt;!ELEMENT description (#PCDATA)&gt;
&lt;!ATTLIST description 
  xml:lang NMTOKEN #IMPLIED&gt;
  &gt;

&lt;!ELEMENT version (#PCDATA)&gt;
&lt;!ATTLIST version 
  vcsrev  CDATA #IMPLIED
  &gt;

&lt;!ELEMENT date (#PCDATA)&gt;
&lt;!ELEMENT producer (#PCDATA)&gt;

&lt;!ELEMENT contact EMPTY&gt;
&lt;!ATTLIST contact 
  email   CDATA #REQUIRED
  website CDATA #REQUIRED
  &gt;

&lt;!ELEMENT acceptor EMPTY&gt;
&lt;!ATTLIST acceptor 
  analyzing (true|false)   "false"
  id CDATA #REQUIRED
  &gt;

&lt;!ELEMENT errmodel (title+, description+)&gt;
&lt;!ATTLIST errmodel 
  id CDATA #REQUIRED
  &gt;</source>
         <p>Most of the elements in this dtd should be straightforward, but a few points should be mentioned:</p>
         <dl>
            <dt>@version of hfstspeller</dt>
            <dd>this is the version of the specification, can be used for compatibility testing during
            initialisation</dd>
            <dt>title, description</dt>
            <dd>at least one is required, which corresponds to the locale of the speller lexicon; no xml:lang attribute
            is required for this one; an unlimited number of additional elements can be added, each with its own unique
            and required xml:lang attribute. These elements are intended to be presented to the end users if supported
            by the host application, f.ex. in a user interface to present the speller, or in an interface element where
            correction models can be chosen.</dd>
            <dt>errmodel</dt>
            <dd>at least one is required; each specified corresponds to a transducer with the filename given in the
            <code>id</code> attribute.</dd>
            <dt>id</dt>
            <dd>is the name of the transducer file in the zip archive</dd>
         </dl>
      </section>
      <section>
         <title>Acceptance transducer</title>
         <p>The default acceptance transducer is a one-level automaton. All complying implementations must support
         this.</p>
         <p>It is also possible to use a two-level, analysing transducer. The analysis output could be used to support
         concext-based filtering of suggestions (ie only present suggestions with a POS that fits in the given context).
         Other usage scenarios are also possible.</p>
         <p>Support for analysing transducers is optional. When the use of such a transducer is specified in the
         index.xml file, an implementation that does not support it may choose to flag an error or silently ignore the
         speller zip archive.</p>
      </section>
      <section>
         <title>Error model transducers</title>
         <p>At least one error model transducer must be present. It is an error for the archive not to contain a
         transducer file named <code>errmodel1.hfst</code>.</p>
         <p>The behaviour when there are multiple error models included is at present undefined, and subject to feedback
         from implementors. Possible options are:</p>
         <ul>
            <li>only apply one at a time, at the users choice through a user configuration interface</li>
            <li>apply all the requested error models together, as if they were joined</li>
         </ul>
      </section>
   </body>
</document>
